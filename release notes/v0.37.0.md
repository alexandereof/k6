k6 v0.37.0 is here! ðŸŽ‰ Mainly it contains fixes and ongoing efforts with refactoring, but it's just because we are preparing some incredible things in upcoming releases!

## New Features!

### Added support for local files to --log-output ([#2285](https://github.com/grafana/k6/pull/2285))

Added file hook for a logger with the possibility to define a minimal reporting level.

The feature speaks for itself with examples of usage:

```sh
k6 run --log-output file=./k6.log --logformat json ./examples/stages.js
```

with a defined log level:

```sh
k6 run --log-output file=./k6.log,level=info --logformat json ./examples/stages.js
```

Thanks, @[alyakimenko](https://github.com/alyakimenko) for the contribution!

**Docs**: [Using file output](https://k6.io/docs/using-k6/options/#file)

### Added experimental basic event loops ([#882](https://github.com/grafana/k6/issues/882))

We added the basic functionality of the JavaScript event loops ([#2228](https://github.com/grafana/k6/pull/2228) and [#2373](https://github.com/grafana/k6/pull/2373)). This is a first step that is limited by a `setTimeout` method as an example. We advise avoiding using it in production code. But for sure, we'll continue to work on extending that feature in the next k6's releases.

If you are curious and can't wait to try it, there is a particular `k6/experimental` module.

```js
import {setTimeout} from "k6/experimental";

export default () => {
    setTimeout(()=> {console.log("say hi to event loops!")}, 200);
}
```

## Extensions

`v0.37.0` finalizes ([#2376](https://github.com/grafana/k6/pull/2376) and [#2384](https://github.com/grafana/k6/pull/2384)) the switching of our internal modules to [a new Go/JavaScript module API](https://k6.io/docs/extensions/guides/create-an-extension/#advanced-javascript-extension). The k6's GRPC module was refactored in order to use the new k6's modules API ([#2365](https://github.com/grafana/k6/pull/2365)) and marked headers' parameter as deprecated ([#2370](https://github.com/grafana/k6/pull/2370))

It's important to highlight that an old API is deprecated and will be removed in the next k6's release (`v0.38.0`). Every extension that isn't implementing the API will get the warning message, like:

```sh
WARN[0000] Module 'k6/x/sql' is using deprecated APIs that will be removed in k6 v0.38.0, for more details on how to update it see https://k6.io/docs/extensions/guides/create-an-extension/#advanced-javascript-extension
```

We did migrations for some xk6 extensions (see connected issues to the task [#2344](https://github.com/grafana/k6/issues/2344)). The pull requests can serve as examples.

## Enhancements and UX improvements

- We continued work on the source map feature: add samples ([#2339](https://github.com/grafana/k6/pull/2339)) and improve loading and parsing ([#2355](https://github.com/grafana/k6/pull/2355)).
- Updated installation from source instructions ([#2359](https://github.com/grafana/k6/pull/2359)). Thanks, @[karitham](https://github.com/Karitham), for making the change.
- We migrated our docker repository to the [grafana/k6](https://hub.docker.com/r/grafana/k6) ([#2377](https://github.com/grafana/k6/pull/2377)).
- Introduced a Go-based thresholds parsing ([#2400](https://github.com/grafana/k6/pull/2400)).
- Enabled more TC39 tests: [optional-chaining](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Optional_chaining) ([#2338](https://github.com/grafana/k6/pull/2338)) and async ([#2396](https://github.com/grafana/k6/pull/2396)).

## Bugs fixed!

- Prevent panic in [check](https://k6.io/docs/javascript-api/k6/check-val-sets-tags) if a second argument isn't provided ([#2387](https://github.com/grafana/k6/pull/2387)).
- `http.head` stopped taking a body as a second argument ([#2402](https://github.com/grafana/k6/pull/2402)). A signature looks like how it was before v0.36.0 `http.head(url, [params])`.
- Fixed [options.scenarios'](https://k6.io/docs/using-k6/options/#scenarios) JSON marshaling ([#2392](https://github.com/grafana/k6/pull/2392)).
- Prevent panic in [http.batch](https://k6.io/docs/javascript-api/k6-http/batch-requests) if pass no arguments (https://github.com/grafana/k6/pull/2415).

## Internals

- We updated our CI to make a developer experience better. Dependency and linter checks run only for pull requests ([#2403](https://github.com/grafana/k6/pull/2403)). We also migrated to a native `golangci-lint` GitHub action. Also bumped the windows version ([#2388](https://github.com/grafana/k6/pull/2388)).
- Updated goja dependency ([#2350](https://github.com/grafana/k6/pull/2350)).
- This release also contains a bunch of the refactoring PRs that fix linters errors ([#2334](https://github.com/grafana/k6/pull/2334), [#2331](https://github.com/grafana/k6/pull/2331) and [#2341](https://github.com/grafana/k6/pull/2341)), remove global variables' usage ([#2336](https://github.com/grafana/k6/pull/2336), [#2358](https://github.com/grafana/k6/pull/2358), [#2353](https://github.com/grafana/k6/pull/2353) and [#2357](https://github.com/grafana/k6/pull/2357)) and remove unnecessary dependency ([#2313](https://github.com/grafana/k6/pull/2313)) which makes our codebase more consistent and maintainable.
- Switched `envconfig` to a fork ([#2337](https://github.com/grafana/k6/pull/2337)) in order to abstract OS package and improve testability.
